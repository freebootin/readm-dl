#!/bin/bash

check_dependencies() {
  local DEPENDENCIES=(curl feh)

  for dep in "${DEPENDENCIES[@]}"; do
    if [[ -z $(command -v ${dep}) ]]; then
      echo "Missing dependency: ${dep}"
      exit 1
    fi
  done
}

setup() {
  local TITLE="${1}"

  mkdir readmtmp
  mkdir "${TITLE}"
}

cleanup() {
  local TITLE="${1}"

  echo "Program interupted...cleaning up..."
  for dir in "${TITLE}" readmtmp; do
    echo rm -rf ${dir}
  done
  echo "Cleanup finished. Please try again."
}

main() {
  local BASE_URL='https://www.readm.org/uploads/chapter_files'
  local BOOK_NUM="${1}"
  local CHAPTER_NUM="${2}"

  curl -s "${BASE_URL}/${BOOK_NUM}/${CHAPTER_NUM}/1.jpg" > test.jpg
}

trap "cleanup ${3}" 1 2 3 6 15
sleep 5
check_dependencies
main $@
